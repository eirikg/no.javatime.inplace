<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria",serif;
	color:#365F91;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Cambria",serif;
	color:#4F81BD;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Cambria",serif;
	color:#4F81BD;}
h4
	{mso-style-link:"Heading 4 Char";
	margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Cambria",serif;
	color:#4F81BD;
	font-style:italic;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:11.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:22.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Header Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"Title Char";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:15.0pt;
	margin-left:0cm;
	font-size:26.0pt;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma",sans-serif;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:36.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria",serif;
	color:#365F91;
	font-weight:bold;}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Cambria",serif;
	color:#365F91;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria",serif;
	color:#4F81BD;
	font-weight:bold;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Cambria",serif;
	color:#4F81BD;
	font-weight:bold;}
span.Heading4Char
	{mso-style-name:"Heading 4 Char";
	mso-style-link:"Heading 4";
	font-family:"Cambria",serif;
	color:#4F81BD;
	font-weight:bold;
	font-style:italic;}
p.msonormal0, li.msonormal0, div.msonormal0
	{mso-style-name:msonormal;
	margin-right:0cm;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
span.HeaderChar
	{mso-style-name:"Header Char";
	mso-style-link:Header;}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;}
span.TitleChar
	{mso-style-name:"Title Char";
	mso-style-link:Title;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma",sans-serif;}
p.msotitlecxspfirst, li.msotitlecxspfirst, div.msotitlecxspfirst
	{mso-style-name:msotitlecxspfirst;
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:26.0pt;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
p.msotitlecxspmiddle, li.msotitlecxspmiddle, div.msotitlecxspmiddle
	{mso-style-name:msotitlecxspmiddle;
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:26.0pt;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
p.msotitlecxsplast, li.msotitlecxsplast, div.msotitlecxsplast
	{mso-style-name:msotitlecxsplast;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:15.0pt;
	margin-left:0cm;
	font-size:26.0pt;
	font-family:"Cambria",serif;
	color:#17365D;
	letter-spacing:.25pt;}
p.msolistparagraphcxspfirst, li.msolistparagraphcxspfirst, div.msolistparagraphcxspfirst
	{mso-style-name:msolistparagraphcxspfirst;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.msolistparagraphcxspmiddle, li.msolistparagraphcxspmiddle, div.msolistparagraphcxspmiddle
	{mso-style-name:msolistparagraphcxspmiddle;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.msolistparagraphcxsplast, li.msolistparagraphcxsplast, div.msolistparagraphcxsplast
	{mso-style-name:msolistparagraphcxsplast;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:36.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.msochpdefault, li.msochpdefault, div.msochpdefault
	{mso-style-name:msochpdefault;
	margin-right:0cm;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;}
p.msopapdefault, li.msopapdefault, div.msopapdefault
	{mso-style-name:msopapdefault;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
span.hps
	{mso-style-name:hps;}
.MsoChpDefault
	{font-size:10.0pt;
	font-family:"Calibri",sans-serif;}
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:70.85pt 70.85pt 70.85pt 70.85pt;}
div.WordSection1
	{page:WordSection1;}
-->
</style>

</head>

<body lang=EN-US link=blue vlink=purple>

<div class=WordSection1>

<p class=MsoTitle><a name="_Toc312283492">Managing Bundle Project Errors</a></p>

<p class=MsoTocHeading>Contents</p>

<p class=MsoToc1><a href="#_Toc433871090">Bundle Project Errors<span
style='color:windowtext;display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoToc2><a href="#_Toc433871091">Build Errors<span style='color:windowtext;
display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoToc2><a href="#_Toc433871092">Life Cycle Errors<span
style='color:windowtext;display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoToc1><a href="#_Toc433871093">Error Management<span
style='color:windowtext;display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoToc2><a href="#_Toc433871094">Sample Use Case<span
style='color:windowtext;display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoToc1><a href="#_Toc433871095">Install and Activate<span
style='color:windowtext;display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoToc1><a href="#_Toc433871096">Resolve<span style='color:windowtext;
display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoToc1><a href="#_Toc433871097">Start and Stop<span style='color:
windowtext;display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoToc1><a href="#_Toc433871098">Update<span style='color:windowtext;
display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoToc1><a href="#_Toc433871099">Startup and Shutdown<span
style='color:windowtext;display:none;text-decoration:none'>. 1</span></a></p>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc433871090">Bundle Project Errors</a></h1>

<p class=MsoNormal>Error handling is centered around the term bundle project
which refers to both the project and its associated bundle or plug-in. For a
quick overview of activating and deactivating bundle projects see <a
href="Dynamic%20Workspace%20Bundles.htm#ActivatingBundleProjects">Activating
Bundle Projects and the Workspace Region</a>. </p>

<p class=MsoNormal>Errors occurs in both bundles and projects and are detected
by the build system, the Eclipse core runtime (only plug-ins), the OSGi
framework and the Java runtime environment. For a description of the
differences between a plug-in and a bundle see <a
href="http://javatime.no/blog/dynamic-bundles-in-eclipse/">Dynamic Bundles in
Eclipse</a>. &nbsp;</p>

<h2><a name="_Toc433871091">Build Errors</a></h2>

<p class=MsoNormal>Errors are divided into build time and life cycle errors.
Build errors generated by Eclipse are further divided into Java and Bundle
build errors. Java build errors include all errors detected by the java
compiler and Bundle build errors, in this context, is directed against errors
prohibiting bundle operations from being executed. Bundle build errors is a mix
of build errors generated by the Eclipse build system and other build time
errors detected by an intermediate layer that sits between the builder and the
OSGi life cycle module. </p>

<p class=MsoNormal>Relevant Bundle build time errors include:</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt'><span
style='font-family:Symbol'>·</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman",serif'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Build state<br>
A project must have a build state before the associated bundle can be installed</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt'><span
style='font-family:Symbol'>·</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman",serif'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Bundle cycles<br>
Direct and indirect circular references between bundles prevent them from being
resolved. See <a href="Dynamic%20Workspace%20Bundles.htm#DepencencyRules">Bundle
Dependencies</a> for a description of bundle cycles.</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt'><span
style='font-family:Symbol'>·</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman",serif'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>External duplicates<br>
It is not possible to resolve and start a workspace bundle that have the same
symbolic name as an external jar bundle. Note that the bundle version does not
have to be the same. </p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt'><span
style='font-family:Symbol'>·</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman",serif'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Workspace duplicates<br>
For workspace bundles, the bundle names may be equal, but they cannot have the
same symbolic name and version. </p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt'><span
style='font-family:Symbol'>·</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman",serif'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Project meta files<br>
Invalid project description files and certain errors in manifest files (e.g.
error in the Bundle-SymbolicName header) prevent bundles from being installed.
Circular references (Import-Package header) between bundles results in resolve
errors while others (e.g. error in the Bundle-Activator header) prevents a
bundle from being started.</p>

<h2><a name="_Toc433871092">Life Cycle Errors</a></h2>

<p class=MsoNormal>Life cycle errors are divided into modular lifecycle
(installed, resolved and uninstalled states) and service lifecycle (starting,
active and stopping states) errors detected and reported by the OSGi life cycle
module. Bundle life cycle errors are critical errors that prevent bundles from
being activated (installed, resolved and started) or cause a bundle operation
to fail, while it is possible to activate bundles with Java build time errors.
Except for runtime errors, which are service errors, modular errors include,
among others, resolve errors, duplicates, cycles, bundle file location access
failures, security violations, bundle state and state change errors. </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;text-autospace:none'>Some errors can be characterized as both as Bundle
build and OSGi modular errors depending on the state of a bundle. These kind of
overlapping errors are detected at build time, right after build or before a
bundle operation is executed if possible. For instance, the Eclipse build
system detects circular references between projects while OSGi in principle
does the same for bundles, although with a more rigorous set of rules. Another
example are duplicates between bundles. Workspace and external (jar bundles)
duplicates are not detected by the Eclipse build system while only workspace
duplicates are detected by the life cycle module. If for instance a cycle is
detected during a build or a duplicate right after a build and the bundle is in
state INSTALLED, the bundle will not be resolved and if in state RESOLVED the
current revision of the bundle is used when updated. &nbsp;It is then possible
to start the bundle, using the current revision, even if the bundle is a
duplicate or is part of a cycle.</p>

<h1><a name="_Toc433871093"></a><a name=ErrorManagement></a>Error Management</h1>

<p class=MsoNormal>The error management is controlled by an intermediate layer
and a validation state machine backing the life cycle of bundles. The intermediate
layer analyze errors produced by the build system, detects additional errors
and make decisions on what kind of bundle operations to perform based on
changes made to source projects. &nbsp;For instance, if new dependencies are
added or removed form a project or when projects are added or removed from the
workspace. The validation machine detects transition errors and generates
errors in case a bundle operation or transition violates the possible bundle
transitions given an initial bundle state. Showing errors states in a state
machine clutters up the diagram, but briefly illustrates where the different
kind of errors are detected. Note that the state machine diagram is slightly
different compared to the one usually shown.</p>

<p class=MsoNormal align=center style='text-align:center'><img border=0
width=707 height=488 src="Bundle%20Project%20Errors_files/image001.png"></p>

<h2><a name="_Toc433871094">Sample Use Case</a></h2>

<p class=MsoNormal>Different use cases that ends up in an error state can be
run on the state machine and a given initial status of projects and the state
of their bundles. A sample use case may be to update a bundle A after it has
been saved and built (the initial state in the diagram) with new dependencies
on a deactivated bundle B in state INSTALLED that already has a reference to
bundle A (cycle error). Bundle A is initially activated and is in state ACTIVE
when adding a dependency (e.g. adding bundle B to its import directive) on
bundle B that already is referencing bundle A in its own import directive.</p>

<p class=MsoNormal>The intermediate layer determines that bundle A should be
stopped, updated, resolved and started (to return to its initial ACTIVE state)
after a build and bundle B should be activated (installed and resolved)
together with bundle A for resolve to succeed. &nbsp;Before updating A, its dependency
graph is constructed showing that bundle A require some capabilities from
bundle B which at the same time require capabilities from A. This results in a
circular reference between A and B and would terminate with a modular resolve
error state if executed. In this case the cycle is detected before the bundle
operations on A and B are executed and results in a cycle bundle build error.
The cycle must in this case be solved by removing one of the import directives
in the source projects before bundle A can be updated after a build. A simpler
use case is activating a duplicate bundle where the install transition from
state UNINSTALLED to state INSTALLED raise a modular install error, causing the
bundle project to return (rollback) to state UNINSTALLED. An alternative is to
let the intermediate layer detect the error, before even entering the install
transition.&nbsp;&nbsp; </p>

<h1><a name=InstallandActivate></a><a name="_Toc433871095"></a><a
name=JavaBuildErrors></a>Install and Activate</h1>

<p class=MsoNormal>Errors in meta data files, duplicates, circular references
between bundle projects and lack of build state are build errors that prevents
bundle projects from being installed and activated. Java build errors does not
prevent a bundle project from being installed, but Bundle build errors do. If a
bundle build error occurs in a deactivated workspace all bundles remains in state
UNINSTALLED. </p>

<h1><a name="_Toc433871096">Resolve</a></h1>

<p class=MsoNormal>In the life cycle of bundles, they are resolved after they
are installed and after they are updated and refreshed when in state RESOLVED
and ACTIVE (and state STARTING/STOPPING). In short, when a bundle is resolved,
all Java classes that the bundle needs, located within the bundle and in all
bundles that the bundle to resolve depends on, are available. </p>

<p class=MsoNormal>The following errors are detected and reported before trying
to resolve a bundle:</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt'><span
style='font-family:Symbol'>·</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman",serif'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Circular references (cycles) result in resolve errors and are detected
before bundles are resolved. See <a
href="Dynamic%20Workspace%20Bundles.htm#DepencencyRules">Dependency Rules</a>
for an explanation of bundle cycles.</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt'><span
style='font-family:Symbol'>·</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman",serif'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Dependencies are calculated where bundles providing capabilities to
bundles to resolve are automatically included in the resolve process to avoid
missing references. Errors are reported if a dependency tree could not be
calculated before trying to resolve the bundles.</p>

<p class=MsoNormal>If the resolver detects any other modular errors, they are
reported and the bundles to resolve are deactivated and moved to state INSTALL
in an activated workspace and state UNINSTALLED in a deactivated workspace. </p>

<h1><a name="_Toc433871097">Start and Stop</a></h1>

<p class=MsoNormal>It is possible to activate a bundle with Java build errors
even if this kind of errors may generate a runtime error when the bundle is
started. If the runtime flow does not execute code where the build errors are
located, no runtime errors occurs due to the build errors. An option is
provided to not allow activation (and thus starting a bundle) of bundle
projects with Java build errors.</p>

<p class=MsoNormal>Any service exceptions thrown in start and stop methods are <span
class=hps><span lang=EN>caught </span></span>and reported. After a service
runtime error, the bundle returns to state RESOLVED. It is possible from the
bundle menus to terminate a bundle while it is running within its start and
stop methods. If stopped manually a service exception is then generated stating
that the start or stop operation was incomplete.</p>

<h1><a name="_Toc433871098">Update</a></h1>

<p class=MsoNormal>A bundle is usually updated after a build at any activation
level (installed, resolved and started).&nbsp; A bundle, together with its
dependent bundles, is assigned a unique revision when resolved. &nbsp;Trying to
update a resolved or started bundle with a bundle – Eclipse build or life cycle
error - error is rejected and the current revision of the involved bundles are
used. In such cases the state of the bundle projects is a project in an
erroneous state and a running bundle executing code from the last error free
build. Bundles with Java build errors may be updated. </p>

<h1><a name="_Toc433871099">Startup and Shutdown</a></h1>

<p class=MsoNormal>At shutdown all bundles are uninstalled and refreshed. If
there were Eclipse build or modular bundle errors at shut down all bundles are
deactivated. If the IDE crashes, the bundles are either deactivated at startup
or installed and resolved (not started) depending on the state of the
workspace. Some projects may be missing build state and need to be refreshed
(e.g. not in sync with the file system) after a crash. It is not possible to
activate the workspace if there are bundles with Eclipse build errors. The
situation at startup is similar to activating the workspace; - That is
installing all workspace bundles and resolving and starting the activated
bundles. </p>

</div>

</body>

</html>
